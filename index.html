<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Mon Pizzagramme</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1b4f5a">
<link rel="icon" href="favicon.ico" />
<style>
  :root{
    --turquoise:#01a6bf; /* couleur principale (turquoise clair) */
    --dark:#1b4f5a;      /* turquoise foncé */
    --gray:#6b7280;
    --bg-gradient-start:#017f90; /* un peu plus profond pour contraste */
    --bg-gradient-end:#ffffff;
    --card:#ffffff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
    color:#222;
    background:linear-gradient(180deg,var(--bg-gradient-start),var(--bg-gradient-end));
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* App container */
  .app{max-width:1100px;margin:28px auto;background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 12px 40px rgba(11,22,28,0.08)}
  header{background:var(--dark);color:#fff;padding:18px 22px}
  header h1{margin:0;font-size:1.25rem;letter-spacing:0.2px}
  main{display:flex;flex-wrap:wrap;padding:18px;gap:18px;align-items:flex-start}
  section{flex:1 1 420px;min-width:260px}
  label{display:block;font-weight:600;margin-top:10px;color:var(--gray);font-size:0.95rem}
  input,select,button{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #e6eef2;font-size:16px}
  /* fix iOS zoom: font-size >= 16 on inputs (done above) */

  input[type=range]{height:28px}
  button{background:var(--turquoise);color:#fff;border:none;cursor:pointer;padding:10px;border-radius:8px;box-shadow:0 6px 18px rgba(1,166,191,0.16)}
  .card{background:#f8fbff;border-left:6px solid var(--turquoise);padding:12px;border-radius:8px}
  .result{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
  .result div{background:#f1f8fb;padding:10px;border-radius:8px;text-align:center;transition:transform .25s ease}
  .timer{font-family:monospace;font-size:1.5rem;color:var(--turquoise);text-align:center;margin-top:10px}
  footer{text-align:right;color:#666;padding:10px;font-size:0.9rem}

  /* Welcome overlay (splash-like) */
  .overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.18),rgba(0,0,0,0.25));display:flex;align-items:center;justify-content:center;z-index:9999}
  .welcome{background:linear-gradient(180deg,var(--bg-gradient-start),var(--bg-gradient-end));padding:22px;border-radius:14px;display:flex;flex-direction:column;align-items:center;gap:12px;box-shadow:0 20px 60px rgba(0,0,0,0.18);width:86%;max-width:560px}
  .logo-badge{width:120px;height:120px;border-radius:22px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;box-shadow:0 12px 30px rgba(0,0,0,0.18)}
  .logo-badge img{width:86px;height:86px;border-radius:14px}
  .welcome h2{margin:0;color:var(--dark);font-size:1.05rem;text-align:center;opacity:0;transform:translateY(8px);animation:fadeUp .7s ease .25s both}
  .welcome .logo{opacity:0;transform:translateY(10px) scale(.98);animation:fadeUp .7s ease both}
  @keyframes fadeUp{from{opacity:0;transform:translateY(8px) translateZ(0)}to{opacity:1;transform:translateY(0)}}
  .fadeout{animation:fadeOut 600ms ease forwards}
  @keyframes fadeOut{to{opacity:0;transform:translateY(-8px)}}

  /* small transitions */
  .fade-section{transition:opacity .25s ease, transform .25s ease}
  .hidden{opacity:0;transform:translateY(6px)}

  /* responsive */
  @media (max-width:800px){
    main{padding:12px;gap:12px}
    .welcome{width:92%}
    .logo-badge{width:96px;height:96px}
    .logo-badge img{width:72px;height:72px}
  }
</style>
</head>
<body>

<!-- welcome overlay (animated) -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="welcome" role="dialog" aria-label="Bienvenue">
    <div class="logo-badge logo"><img src="icon-512.png" alt="Mon Pizzagramme"></div>
    <h2>Mon Pizzagramme — Calculateur de pâte à pizza</h2>
  </div>
</div>

<!-- main app -->
<div class="app" id="app" aria-live="polite">
  <header>
    <h1>Mon Pizzagramme</h1>
  </header>

  <main>
    <!-- controls -->
    <section class="fade-section" id="controls">
      <label for="preset">Type de pizza</label>
      <select id="preset" aria-label="Type de pizza"></select>

      <label for="numBalls">Nombre de pâtons</label>
      <input id="numBalls" type="number" value="4" min="1" inputmode="numeric">

      <label for="weightPerBall">Poids par pâton (g)</label>
      <input id="weightPerBall" type="number" value="250" min="1" inputmode="numeric">

      <label for="totalWeight">Poids total de pâte (g)</label>
      <input id="totalWeight" type="number" value="1000" min="1" inputmode="numeric">

      <label>Hydratation (%) <span id="hydrationVal">60%</span></label>
      <input id="hydration" type="range" min="40" max="90" value="60">

      <label>Sel (% farine) <span id="saltVal">2%</span></label>
      <input id="saltPct" type="range" min="0" max="5" step="0.1" value="2">

      <label>Levure instant. (% farine) <span id="yeastVal">0.20%</span></label>
      <input id="yeastPct" type="range" min="0" max="1.5" step="0.01" value="0.20">
    </section>

    <!-- outputs -->
    <section class="fade-section" id="outputs">
      <div class="card" id="ingredientsCard">
        <h3>Ingrédients calculés</h3>
        <div class="result" id="resultGrid" aria-live="polite">
          <div><small>Farine</small><div id="flour" style="font-weight:700;font-size:1.2rem;margin-top:6px">0 g</div></div>
          <div><small>Eau</small><div id="water" style="font-weight:700;font-size:1.2rem;margin-top:6px">0 g</div></div>
          <div><small>Sel</small><div id="salt" style="font-weight:700;font-size:1.2rem;margin-top:6px">0 g</div></div>
          <div><small>Levure inst.</small><div id="yeast" style="font-weight:700;font-size:1.2rem;margin-top:6px">0 g</div></div>
          <div style="grid-column:1/-1"><small>Levure fraîche (approx.)</small><div id="yeastFresh" style="font-weight:700;font-size:1.2rem;margin-top:6px">0 g</div></div>
          <div style="grid-column:1/-1"><small>Total pâte</small><div id="totalDesc" style="font-weight:700;font-size:1rem;margin-top:6px">0 g</div></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px" id="timerCard">
        <h3>Minuteur de fermentation</h3>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="timerMinutes" type="number" value="0" style="width:100px" inputmode="numeric"> minutes
          <div style="margin-left:auto;display:flex;gap:8px">
            <button id="startTimer">Start</button>
            <button id="pauseTimer" style="background:#fff;color:var(--turquoise);border:1px solid #d1d5db">Pause</button>
            <button id="resetTimer" style="background:#fff;color:var(--turquoise);border:1px solid #d1d5db">Reset</button>
          </div>
        </div>
        <div class="timer" id="timerDisplay">00:00</div>
      </div>

      <div class="card" style="margin-top:12px" id="tempCard">
        <h3>Calculateur température d'eau</h3>
        <label>Temp. finale souhaitée (°C)</label><input id="desiredDoughTemp" type="number" value="26" inputmode="numeric">
        <label>Temp. ambiante (°C)</label><input id="roomTemp" type="number" value="22" inputmode="numeric">
        <label>Temp. farine (°C)</label><input id="flourTemp" type="number" value="22" inputmode="numeric">
        <label>Facteur friction (°C)</label><input id="frictionFactor" type="number" value="5" inputmode="numeric">
        <p style="margin-top:8px"><strong>Temp. eau ≈ <span id="waterTemp">0</span> °C</strong></p>
      </div>
    </section>
  </main>

  <footer>Développé avec ♥ — Mon Pizzagramme</footer>
</div>

<script>
/* PRESETS */
const PRESETS = {
  "Napolitaine": { hydration: 0.60, saltPct: 0.02, yeastPct: 0.002 },
  "Romaine": { hydration: 0.65, saltPct: 0.02, yeastPct: 0.002 },
  "New York": { hydration: 0.62, saltPct: 0.02, yeastPct: 0.0015 },
  "Detroit": { hydration: 0.70, saltPct: 0.02, yeastPct: 0.0025 },
  "Biga": { hydration: 0.58, saltPct: 0.02, yeastPct: 0.0015 }
};

/* ELEMENTS */
const presetSel = document.getElementById('preset');
Object.keys(PRESETS).forEach(k=>{
  const o=document.createElement('option'); o.value=k; o.textContent=k; presetSel.appendChild(o);
});
presetSel.value='Napolitaine';

const numBallsEl=document.getElementById('numBalls');
const weightPerBallEl=document.getElementById('weightPerBall');
const totalWeightEl=document.getElementById('totalWeight');
const hydrationEl=document.getElementById('hydration');
const saltPctEl=document.getElementById('saltPct');
const yeastPctEl=document.getElementById('yeastPct');
const flourEl=document.getElementById('flour');
const waterEl=document.getElementById('water');
const saltEl=document.getElementById('salt');
const yeastEl=document.getElementById('yeast');
const yeastFreshEl=document.getElementById('yeastFresh');
const totalDescEl=document.getElementById('totalDesc');
const hydrationVal=document.getElementById('hydrationVal');
const saltVal=document.getElementById('saltVal');
const yeastVal=document.getElementById('yeastVal');

/* STATE */
let numBalls = Number(numBallsEl.value);
let weightPerBall = Number(weightPerBallEl.value);
let totalWeight = Number(totalWeightEl.value);
let hydration = PRESETS['Napolitaine'].hydration;
let saltPct = PRESETS['Napolitaine'].saltPct;
let yeastPct = PRESETS['Napolitaine'].yeastPct;

/* RECALC */
function recalcFromTotal(){
  const combinePct = 1 + hydration + saltPct + yeastPct;
  const F = totalWeight / combinePct;
  const W = F * hydration;
  const S = F * saltPct;
  const Y = F * yeastPct;
  flourEl.textContent = Math.round(F);
  waterEl.textContent = Math.round(W);
  saltEl.textContent = S.toFixed(1);
  yeastEl.textContent = Y.toFixed(2);
  yeastFreshEl.textContent = (Y*3).toFixed(2);
  totalDescEl.textContent = totalWeight + ' g — ' + numBalls + ' pâtons × ' + weightPerBall + ' g';
  // small pop animation on results
  document.querySelectorAll('#resultGrid > div').forEach(n=>{ n.style.transform='scale(1.02)'; setTimeout(()=>n.style.transform='scale(1)',120); });
}

/* EVENTS */
numBallsEl.oninput = ()=>{
  numBalls = Number(numBallsEl.value);
  totalWeight = Math.round(numBalls * weightPerBall);
  totalWeightEl.value = totalWeight;
  recalcFromTotal();
};
weightPerBallEl.oninput = ()=>{
  weightPerBall = Number(weightPerBallEl.value);
  totalWeight = Math.round(numBalls * weightPerBall);
  totalWeightEl.value = totalWeight;
  recalcFromTotal();
};
totalWeightEl.oninput = ()=>{
  totalWeight = Number(totalWeightEl.value);
  recalcFromTotal();
};
hydrationEl.oninput = (e)=>{
  hydration = Number(e.target.value)/100;
  hydrationVal.textContent = e.target.value + '%';
  recalcFromTotal();
};
saltPctEl.oninput = (e)=>{
  saltPct = Number(e.target.value)/100;
  saltVal.textContent = e.target.value + '%';
  recalcFromTotal();
};
yeastPctEl.oninput = (e)=>{
  yeastPct = Number(e.target.value)/100;
  yeastVal.textContent = Number(e.target.value).toFixed(2) + '%';
  recalcFromTotal();
};
presetSel.onchange = (e)=>{
  const pr = PRESETS[e.target.value];
  hydration = pr.hydration; saltPct = pr.saltPct; yeastPct = pr.yeastPct;
  hydrationEl.value = Math.round(hydration*100);
  saltPctEl.value = saltPct*100;
  yeastPctEl.value = yeastPct*100;
  hydrationVal.textContent = Math.round(hydration*100) + '%';
  saltVal.textContent = (saltPct*100).toFixed(1) + '%';
  yeastVal.textContent = (yeastPct*100).toFixed(2) + '%';
  // small transition effect
  document.getElementById('controls').classList.add('hidden');
  setTimeout(()=>{ recalcFromTotal(); document.getElementById('controls').classList.remove('hidden'); }, 180);
};

/* TIMER */
let timer=null; let secs=0;
const timerDisplay = document.getElementById('timerDisplay');
const timerMinutes = document.getElementById('timerMinutes');
document.getElementById('startTimer').onclick = ()=>{ if(timer)clearInterval(timer); secs = Number(timerMinutes.value)*60; updateTimer(); timer = setInterval(()=>{ if(secs<=0){ clearInterval(timer); return;} secs--; updateTimer(); },1000); };
document.getElementById('pauseTimer').onclick = ()=>{ if(timer){ clearInterval(timer); timer=null; } };
document.getElementById('resetTimer').onclick = ()=>{ if(timer){ clearInterval(timer);} secs=0; updateTimer(); };
function updateTimer(){ const m=Math.floor(secs/60), s=secs%60; timerDisplay.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }

/* WATER TEMP CALC */
function calcWaterTemp(){
  const desired = Number(document.getElementById('desiredDoughTemp').value);
  const room = Number(document.getElementById('roomTemp').value);
  const flourT = Number(document.getElementById('flourTemp').value);
  const friction = Number(document.getElementById('frictionFactor').value);
  const waterT = desired*3 - (room + flourT + friction);
  document.getElementById('waterTemp').textContent = waterT.toFixed(1);
}
['desiredDoughTemp','roomTemp','flourTemp','frictionFactor'].forEach(id=>document.getElementById(id).oninput = calcWaterTemp);

/* INIT & welcome overlay hide */
document.addEventListener('DOMContentLoaded', ()=>{
  recalcFromTotal();
  calcWaterTemp();
  setTimeout(()=>{ const ov = document.getElementById('overlay'); ov.classList.add('fadeout'); setTimeout(()=>ov.style.display='none',700); }, 1100);
});

/* Register service worker (if present) */
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('sw.js').then(()=>console.log('SW registered')).catch(()=>console.log('SW failed'));
  });
}
</script>
</body>
</html>
